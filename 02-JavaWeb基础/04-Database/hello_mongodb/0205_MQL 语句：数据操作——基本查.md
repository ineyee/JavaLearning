## 查 find

**查询的格式如下：**

```javascript
db.要查询的集合.find(
  { 这里是第一个 map 参数，作用类似于 SQL 语句里的 WHERE，用来写查询条件 },
	{ 这里是第二个 map 参数，用来一一列出要查询哪些字段 }
)
.sort({ 排序规则 })
.skip(跳过多少条 = (pageNum - 1) * pageSize)
.limit(返回多少条 = pageSize)
```

* 查询条件

| {} 或条件符                                                 | 含义                               |
| ----------------------------------------------------------- | ---------------------------------- |
| 只写一个空的 **{}**                                         | 啥条件也没有、全部数据             |
|                                                             |                                    |
| 什么条件符都不写，默认就是 **$eq** (equal)                  | =                                  |
| **$ne** (not equal)                                         | !=                                 |
| **$gt** (greater than)                                      | >                                  |
| **$gte** (greater than or equal)                            | >=                                 |
| **$lt** (less than)                                         | <                                  |
| **$lte** (less than or equal)                               | <=                                 |
| **$in**                                                     | 某个字段的值是否在指定的数组里面   |
| **$nin** (not in)                                           | 某个字段的值是否不在指定的数组里面 |
| **$exists**                                                 | 某个字段存不存在 = 等不等于 null   |
|                                                             |                                    |
| **$and**                                                    | 且                                 |
| **$or**                                                     | 或                                 |
|                                                             |                                    |
| **MySQL 里模糊查询用 LIKE，MongoDB 里模糊查询用正则表达式** |                                    |

* 要查询哪些字段

MongoDB 里一一列出要查询哪些字段有两种模式：**包含模式**（常用、类似于 SQL 语句里一一列出要查询哪些字段）和**排除模式**（当包含模式要列出的字段太多、你觉得麻烦时、可以用这个），但是注意**包含模式和排除模式必须独立使用、不能混合使用。不过 _id 字段比较特殊，无论什么模式下都可以随意包含或排除**

```javascript
// 下面两种写法查出来的数据其实是一样的
db.product.find(
	{},
	{
		"name": 1, // 把想要查询的字段写成 1 就是包含模式
		"price": 1
	}
);
db.product.find(
	{},
	{
		"desc": 0 // 把不想查询的字段写成 0 就是排除模式
	}
);
```

## 1、全部查询

* 查询所有数据的所有字段

```javascript
// 第一个 map 参数写 {}，代表查询所有数据
// 第二个 map 参数不写，默认就是查询所有字段
db.product.find({});
```

* 查询所有数据的部分字段

```javascript
// 第一个 map 参数写 {}，代表查询所有数据
// 第二个 map 参数一一列出要查询哪些字段
db.product.find(
	{},
	{
		"name": 1,
		"price": 1,
		"_id": 0
	}
);
```

## 2、条件查询

* 查询部分数据的所有字段

```javascript
// 第一个 map 参数什么条件符都不写，默认就是 $eq
// 第二个 map 参数不写，默认就是查询所有字段
db.product.find({ "name": "iPhoneX" });
```

* 查询部分数据的部分字段

```javascript
// 第一个 map 参数什么条件符都不写，默认就是 $eq
// 第二个 map 参数一一列出要查询哪些字段
db.product.find(
	{ "name": "iPhoneX" },
	{
		"name": 1,
		"price": 1,
		"_id": 0
	}
);
```

* 比较运算符类型的条件

```javascript
// = !=
db.product.find({ "name": "iPhoneX" });
db.product.find({
    "name": {
        $ne: "iPhoneX"
    }
});

// > >=
db.product.find({
    "price": {
        $gt: 6666
    }
});
db.product.find({
    "price": {
        $gte: 6666
    }
});

// < <=
db.product.find({
    "price": {
        $lt: 6666
    }
});
db.product.find({
    "price": {
        $lte: 6666
    }
});

// in notin
db.product.find({
	"price": {
		$in: [8888, 6666]
	}
});
db.product.find({
	"price": {
		$nin: [8888, 6666]
	}
});

// 判断某个字段是不是空 = 存不存在，可以直接判断等不等于 null，也可以判断字段存不存在
db.product.find({
	"brand": null
});
db.product.find({
	"brand": {
		$ne: null
	}
});
db.product.find({
	"brand": {
		$exists: false
	}
});
db.product.find({
	"brand": {
		$exists: true
	}
});
```

* 逻辑运算符类型的条件

```javascript
// 第一个 map 参数有多个查询条件时，默认就是且
// 当然我们也可以显式写出来，多个条件组成的是一个数组
db.product.find({
	"brand": "Apple",
	"price": {
		$lte: 6666
	}
});
db.product.find({
	$and: [
		{ "brand": "Apple" },
		{
			"price": {
				$lte: 6666
			}
		}
	]
});

// 或必须显式写出来，多个条件组成的是一个数组
db.product.find({
	$or: [
		{ "brand": "Apple" },
		{
			"price": {
				$lte: 6666
			}
		}
	]
});
```

* 模糊查询类型的条件

```javascript
// 查询 name 里所有以 iPhone 开头的
// 只要以 iPhone 开头，后面不管是多少个什么字符
db.product.find({
	"name": /^iPhone/
});

// 查询 name 里带 8GB 的
// 只要带 8GB，前面和后面不管是多少个什么字符
db.product.find({
	"name": /8GB/
});

// 查询 name 里带 米 的，且 米 必须是第四个字符
// 前面得有三个字符，后面不管是多少个什么字符
db.product.find({
	"name": /^...米/
});
```

## 3、对查询结果进行排序

```javascript
db.product.find().sort({
   "price": 1 // 1 代表按这个字段升序排序
});

// 先按 price 降序排序，如果 price 相同时再按 _id 降序排序
db.product.find().sort({
   "price": -1, // -1 代表按这个字段降序排序
	 "_id": -1
});
```

## 4、分页查询

```javascript
// 假设一页 3 条数据，这就是查询第 1 页数据
db.product.find().skip(0).limit(3);
// 假设一页 3 条数据，这就是查询第 2 页数据
db.product.find().skip(3).limit(3);
// 假设一页 3 条数据，这就是查询第 3 页数据
db.product.find().skip(6).limit(3);
```