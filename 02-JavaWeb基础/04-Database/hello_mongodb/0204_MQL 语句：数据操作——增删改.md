一个集合里可以有多个文档，一个文档对应一条数据、数据都以 JSON 的形式存在

## 一、增 insert

> db.product.insert( 一个 map 或一个数组\<map\> );

* 单条增加

```javascript
db.product.insertOne({
	"name": "iPhoneX",
	"desc": "初代全面屏",
	"price": 8888
});
```

* 批量增加

```javascript
db.product.insertMany([
  { name: "iPhoneX", desc: "初代全面屏", price: 8888 },
  { name: "华为 Mate70", price: 6666 },
  { name: "小米 10", price: 4444 }
]);
```

## 二、删 delete

> db.product.delete({
> 	这里是一个 map 参数，作用类似于 SQL 语句里的 WHERE，用来写删除条件
> });

* 单条删除

```javascript
// 删除 name = iPhoneX 的那条数据
db.product.deleteOne({
	"name": "iPhoneX",
});
```

* 批量删除

```javascript
// MongoDB 的默认主键是 _id，不是 id
db.product.deleteMany({
	"_id": { $in: [ ObjectId("699d4fc4a856defae30dcb4e"), ObjectId("699d4fc4a856defae30dcb4fq") ] }
});

// 如果自己定义了主键 id
db.product.deleteMany({
  "id": { $in: [ 1, 2, 3 ] }
});
```

* 全部删除

```javascript
// 删除全部数据
db.product.deleteMany({});
```

## 三、改 update

> db.product.update(
> 	{ 这里是第一个 map 参数，作用类似于 SQL 语句里的 WHERE，用来写修改条件 },
> 	{ 这里是第二个 map 参数，作用类似于 SQL 语句里的 SET，用来写要修改的字段及其新值 }
> );
>
> 要修改的字段及其新值那里：固定得写个 $set 的 key**（如果原数据里有这个字段就是修改操作，没有这个字段就是新增字段操作）**

* 单条修改

```javascript
// 找到 name = iPhoneX 的那条数据，把这条数据的 desc 改成 初代全面屏，使用 FaceID
db.product.updateOne(
	{ "name": "iPhoneX" },
	{ $set: { "desc": "初代全面屏，使用 FaceID" } }
);
```

* 批量修改

```javascript
// 找到 price <= 6666 的那些数据，把这些数据的 desc 改成 价格低，质量高
db.product.updateMany(
	{ "price": { $lte: 6666 } },
	{ $set: { "desc": "价格低，质量高" } }
);
```

* 全部修改

```javascript
// 把所有数据的 desc 改成 统统 2 元，先到先得，把所有数据的 price 改成 2 元
db.product.updateMany(
	{},
	{
		$set: {
			"desc": "统统 2 元，先到先得",
			"price": 2
		}
	}
);
```

## 补充：数组类型字段的元素操作（本质其实就是上面的 update）

#### 1、添加数组字段

给 iPhoneX 这条数据添加一个 designerList 的数组类型字段

```javascript
db.product.updateMany(
	{ "name": "iPhoneX" },
	{
		$set: {
			"designerList": []
		}
	}
);
```

#### 2、给数组字段里添加元素

给 iPhoneX 这条数据的 designerList 字段里添加元素**（本质其实就是更新这个字段的值，只不过不是用 $set 整个覆盖、而是用 $push 或 $addToSet 追加，push 的时候不会自动判断数组里有没有这个元素、所以可能重复，addToSet 的时候会自动判断数组里有没有这个元素、没有的话才会添加进去、所以不可能重复）**

* 单个添加

```javascript
// 找到 name = iPhoneX 的这条数据
// 给这条数据 designerList 字段里 push 一个 张三 进去
db.product.updateMany(
	{ "name": "iPhoneX" },
	{
		$push: {
			"designerList": {
				"name": "张三",
				"age": 33,
				"sex": "男"
			}
		}
	}
);

// 找到 name = iPhoneX 的这条数据
// 给这条数据 designerList 字段里 addToSet 一个 张三 进去
db.product.updateMany(
	{ "name": "iPhoneX" },
	{
		$addToSet: {
			"designerList": {
				"name": "张三",
				"age": 33,
				"sex": "男"
			}
		}
	}
);
```

* 批量添加

```javascript
// 找到 name = iPhoneX 的这条数据
// 给这条数据 designerList 字段里迭代 push 李四、王五、赵六 进去
db.product.updateMany(
	{ "name": "iPhoneX" },
	{
		$push: {
			"designerList": {
				$each: [
					{ "name": "李四", "age": 44, "sex": "女" },
					{ "name": "王五", "age": 55, "sex": "男" },
					{ "name": "赵六", "age": 66, "sex": "女" }
				]
			}
		}
	}
);

// 找到 name = iPhoneX 的这条数据
// 给这条数据 designerList 字段里迭代 addToSet 赵六、孙七、钱八 进去
db.product.updateMany(
	{ "name": "iPhoneX" },
	{
		$addToSet: {
			"designerList": {
				$each: [
					{ "name": "孙七", "age": 77, "sex": "女" },
					{ "name": "钱八", "age": 88, "sex": "男" }
				]
			}
		}
	}
);
```

#### 3、删除数组字段里的元素

删除 iPhoneX 这条数据的 designerList 字段里的元素**（本质其实就是更新这个字段的值，只不过不是用 $set 整个覆盖、而是用 $pull 或 $pop 删除指定的元素，$pull 类似于 removeObject、$pop 用来删除头元素或尾元素、没有 removeObjectAtIndex 这种）**

* 单个删除

```javascript
// 找到 name = iPhoneX 的这条数据
// pull 删除这条数据 designerList 字段里的 孙七 元素
db.product.update(
	{ "name": "iPhoneX" },
	{
		$pull: {
			"designerList": {
				"name": "孙七"
			}
		}
	}
);

// 找到 name = iPhoneX 的这条数据
// pop 删除这条数据 designerList 字段里的头元素或尾元素
db.product.update(
	{ "name": "iPhoneX" },
	{
		$pop: {
			"designerList": 1 // 1 代表删除尾元素
		}
	}
);
db.product.update(
	{ "name": "iPhoneX" },
	{
		$pop: {
			"designerList": -1 // -1 代表删除头元素
		}
	}
);
```

* 批量删除

```javascript
// 找到 name = iPhoneX 的这条数据
// pull + in 批量删除这条数据 designerList 字段里的 张三、李四、王五 元素
db.product.update(
	{ "name": "iPhoneX" },
	{
		$pull: {
			"designerList": {
				"name": {
					$in: ["张三", "李四", "王五"]
				}
			}
		}
	}
);
```

#### 4、修改数组字段里的元素

修改 iPhoneX 这条数据的 designerList 字段里的元素**（本质其实就是更新这个字段的值）**

* 通过索引修改，类似于 replaceObjectAtIndex(index, newObj)

```javascript
// 找到 name = iPhoneX 的这条数据
// set 修改这条数据 designerList 字段里 index = 0 的元素为 首席设计师-刘大
db.product.update(
	{ "name": "iPhoneX" },
	{
		$set: {
			"designerList.0.name": "首席设计师-刘大"
		}
	}
);
```

* 通过元素修改，类似于 replaceObject(oldObj, newObj)

```javascript
// 找到 name = iPhoneX 的这条数据，再找到这条数据 designerList 字段里值为 王五 的元素
// set 修改相应元素的值为 王五五（designerList.$ 其实就是上面找到的元素）
db.product.update(
	{
		"name": "iPhoneX",
		"designerList.name": "王五"
	},
	{
		$set: {
			"designerList.$.name": "王五五"
		}
	}
);
```

#### 5、把数组字段作为查询条件时的匹配规则

* 完全匹配：数据库里数组的元素、元素顺序，必须和我们这里提供的查询数组的元素、元素顺序一模一样，才能查询出来

```javascript
db.product.find({
	"designerList": [
		{
				"name": "首席设计师-刘大",
				"age": 66,
				"sex": "女"
		},
		{
				"name": "孙七",
				"age": 77,
				"sex": "女"
		},
		{
				"name": "钱八",
				"age": 88,
				"sex": "男"
		},
		{
				"name": "李四",
				"age": 44,
				"sex": "女"
		},
		{
				"name": "王五五",
				"age": 55,
				"sex": "男"
		}
	]
});
```

* 全包含匹配：数据库里数组的元素，只要包含全部我们这里提供的查询数组的元素，就能查询出来

```javascript
db.product.find({
	"designerList": {
		$all: [
			{
				"name": "孙七",
				"age": 77,
				"sex": "女"
			},
			{
				"name": "钱八",
				"age": 88,
				"sex": "男"
			}
		]
	}
});

db.product.find({
	"designerList.name": {
		$all: ["孙七", "钱八"]
	}
});
```

* 任一包含匹配：数据库里数组的元素，只要包含任意一个我们这里提供的查询数组的元素，就能查询出来，查询数组的元素只有一个时，可以省略 $in

```javascript
db.product.find({
	"designerList.name": {
		$in: ["孙七", "钱八八"]
	}
});
db.product.find({
	"designerList.name": "孙七"
});
```

* 按数组长度查询：只要长度能匹配上，就能查询出来

```javascript
db.product.find({
	"designerList": {
		$size: 5
	}
});
```
