<?xml version="1.0" encoding="utf-8" ?>
<!--
    scan="true" scanPeriod="30 seconds"
    让 logback 每隔 30 秒重新扫描一下配置文件，并应用最新的配置文件
-->
<configuration scan="true" scanPeriod="30 seconds">
    <!--
        使用 property 标签定义一个变量，抽取日志文件所在目录
            线上 Linux 系统，我们输出到 /var/log/app.log 文件中
    -->
    <property name="LOG_FILE_HOME" value="/var/log"/>

    <!-- 定义一个输出目标：控制台 -->
    <appender name="consoleAppender" class="ch.qos.logback.core.ConsoleAppender">
        <!-- 控制台的输出格式与编码方式 -->
        <encoder class="ch.qos.logback.classic.encoder.PatternLayoutEncoder">
            <!--
                输出格式
                    %highlight：彩色输出
                    %d：时间
                    %p：日志级别
                    %t：线程
                    %c：消息是在哪个类里输出的
                    %m：消息
                    %n：换行
            -->
            <pattern>%highlight([%d{yyyy-MM-dd HH:mm:ss.SSS}] [%-5p] [%t] [%c]: %m%n)</pattern>
            <!-- 编码方式：UTF-8 -->
            <charset>UTF-8</charset>
        </encoder>
    </appender>

    <!-- 定义一个输出目标：文件 -->
    <appender name="rollingFileAppender" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <!-- 文件的输出格式与编码方式 -->
        <encoder class="ch.qos.logback.classic.encoder.PatternLayoutEncoder">
            <!--
                输出格式
                    %highlight：彩色输出
                    %d：时间
                    %p：日志级别
                    %t：线程
                    %c：消息是在哪个类里输出的
                    %m：消息
                    %n：换行
            -->
            <pattern>%highlight([%d{yyyy-MM-dd HH:mm:ss.SSS}] [%-5p] [%t] [%c]: %m%n)</pattern>
            <!-- 编码方式：UTF-8 -->
            <charset>UTF-8</charset>
        </encoder>
        <!-- 文件的路径 -->
        <file>${LOG_FILE_HOME}/app.log</file>
        <!--
            文件的滚动策略
                每隔一天，自动生成一个新文件，以当天日期命名
                单个文件最大 100M，超过 100M 时自动生成一个新文件，以当天日期命名
                所有文件总大小最大 10G，超过 10G 时自动清理最早的文件
                自动清理超过 30 天的文件
        -->
        <rollingPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">
            <!-- 自动生成的新文件名 -->
            <fileNamePattern>${LOG_FILE_HOME}/app.%d{yyyy-MM-dd}.%i.log</fileNamePattern>
            <!-- 单个文件最大大小 -->
            <maxFileSize>100MB</maxFileSize>
            <!-- 所有文件总大小 -->
            <totalSizeCap>10GB</totalSizeCap>
            <!-- 最多保留多少天 -->
            <maxHistory>30</maxHistory>
        </rollingPolicy>
    </appender>

    <!--
        开发环境的 logger 配置
        application.yml 里的 active: - dev | - prd 会自动匹配这里的环境
    -->
    <springProfile name="dev">
        <!--
            项目里所有 logger 的配置都写在这个 root 标签里
                日志级别为：DEBUG
                是否给父 logger 传递日志事件：false
                输出目标为：控制台
        -->
        <root level="DEBUG" additivity="false">
            <appender-ref ref="consoleAppender"/>
        </root>

        <!--
            如果我们想给某个包里的 logger 单独配置，可以新增一个 logger 标签
            controller 包里所有 logger 的配置都写在这个 logger 标签里，会覆盖 root 标签里的配置
                日志级别为：DEBUG
                是否给父 logger 传递日志事件：false（默认 true，会把日志事件传递给 rootLogger，导致打印多遍，所以总应设置为 false）
                输出目标为：控制台
        -->
        <logger name="com.ineyee.controller" level="DEBUG" additivity="false">
            <appender-ref ref="consoleAppender"/>
        </logger>
        <!--
            如果我们想给某个类里的 logger 单独配置，可以新增一个 logger 标签
            TestService 类里 logger 的配置都写在这个 logger 标签里，会覆盖 root 标签里的配置
                日志级别为：WARN
                是否给父 logger 传递日志事件：false（默认 true，会把日志事件传递给 rootLogger，导致打印多遍，所以总应设置为 false）
                输出目标为：控制台
        -->
        <logger name="com.ineyee.service.TestService" level="WARN" additivity="false">
            <appender-ref ref="consoleAppender"/>
        </logger>
    </springProfile>

    <!--
        生产环境的 logger 配置
        application.yml 里的 active: - dev | - prd 会自动匹配这里的环境
    -->
    <springProfile name="prd">
        <!--
            项目里所有 logger 的配置都写在这个 root 标签里
                日志级别为：INFO
                是否给父 logger 传递日志事件：false
                输出目标为：文件
        -->
        <root level="DEBUG" additivity="false">
            <appender-ref ref="rollingFileAppender"/>
        </root>
    </springProfile>
</configuration>